<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ROPbyt3s WriteUps</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <nav aria-label="Section navigation">
      <div class="brand">ROPbyt3s WriteUps</div>
      <ul class="menu">
        <li><a href="#home" data-section="home" aria-current="page">_Main <small>Welcome</small></a></li>
        <!-- IMPORTANT: relative path (no leading slash) -->
        <li><a href="#test" data-external="pages/test.html">Support <small>Tips</small></a></li>
      </ul>
      <div class="footer"> <span id="year"></span> WriteUps</div>
    </nav>

    <main id="content" tabindex="-1" aria-live="polite" aria-atomic="true"></main>
  </div>

  <script>
    // --- Content for internal sections ---
    const sections = {
      home: `
        <section class="hero">
        <h1 class="hero-title">ROPbyt3s WriteUps</h1>
        <p class="hero-sub">Creating comprehensive Writeups as often as I can.</p>
        <img class="hero-img" src="pages/profile.png" alt="ROPbyt3s banner" />
        <p class="hero-sub"><---- Thank You For Your Support! ---></p>
        </section>
      `,
    };

    const content = document.getElementById('content');
    const navLinks = [...document.querySelectorAll('nav a')];

    function setActive(link) {
      navLinks.forEach(a => a.setAttribute('aria-current', a === link ? 'page' : 'false'));
    }

    function renderInternal(key) {
      content.innerHTML = sections[key] || sections.home;
      content.focus({ preventScroll: true });
    }

    async function renderExternal(url) {
      try {
        const res = await fetch(url, { cache: 'no-cache' });
        let html = await res.text();

        // If test.html is a full document, extract body/main so styles remain uniform.
        if (/<html[^>]*>/i.test(html)) {
          const doc = new DOMParser().parseFromString(html, 'text/html');
          html = (doc.querySelector('main')?.innerHTML) || doc.body.innerHTML || html;
        }

        content.innerHTML = html;
        content.focus({ preventScroll: true });
      } catch (e) {
        content.innerHTML = `<div class="card"><p>Could not load <code>${url}</code>.</p></div>`;
      }
    }

    // Clicks (no page reload)
    navLinks.forEach(a => a.addEventListener('click', e => {
      const internal = a.dataset.section;
      const external = a.dataset.external;
      if (internal || external) e.preventDefault();
      if (internal) {
        history.replaceState(null, '', `#${internal}`);
        renderInternal(internal); setActive(a);
      } else if (external) {
        history.replaceState(null, '', '#test');
        renderExternal(external); setActive(a);
      }
    }));

    // Hash support (refresh/back)
    function loadFromHash() {
      const hash = (location.hash || '#home').slice(1);
      if (sections[hash]) {
        const link = navLinks.find(a => a.dataset.section === hash);
        setActive(link || null); renderInternal(hash); return;
      }
      if (hash === 'test') {
        const link = navLinks.find(a => a.dataset.external);
        if (link) { setActive(link); renderExternal(link.dataset.external); return; }
      }
      // default
      const first = navLinks.find(a => a.dataset.section === 'home');
      setActive(first || null); renderInternal('home');
    }

    document.getElementById('year').textContent = new Date().getFullYear();
    window.addEventListener('hashchange', loadFromHash);
    loadFromHash();
  </script>
</body>
</html>
